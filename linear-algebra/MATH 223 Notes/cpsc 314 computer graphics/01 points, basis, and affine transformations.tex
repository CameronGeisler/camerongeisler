\documentclass[letterpaper,12pt]{article}
\input{preamble}

\chead{}

\begin{document}


\section*{Points, Vectors, and Coordinates}
\begin{definition}
Broadly,
\begin{itemize}
    \item A \textbf{point} $\tilde{p}$ is a ``real" geometric position (or location) in space, denoted by a letter with a tilde above.
    \item A \textbf{vector} $\vec{v}$ is an geometric object that represents motion between two points, which can be combined algebraically with other vectors through addition and scalar multiplication.
    \item A \textbf{coordinate vector} is a numerical collection of real numbers used to represent a vector, in a particular coordinate system.
\end{itemize}
\end{definition}

In particular,
\begin{itemize}
    \item A vector is \textit{not} an array of numbers.
    \item Vectors can be added to each other, but points cannot be added to each other.
\end{itemize}

\section*{Coordinate Systems (Bases)}
\begin{definition}
A \textbf{coordinate system} (or \textbf{basis}) in space is a set of 3 vectors $\set{\vec{b}_1, \vec{b}_2, \vec{b}_3}$ which are linearly independent (equivalently, no vector can be written as a linear combination of the others).
\end{definition}

Every vector $\vec{v}$ in space can be uniquely written in terms of a linear combination of basis vectors. In other words, there exists $c_1, c_2, c_3 \in \mathbb{R}$ such that,
\begin{equation*}
    \boxed{\vec{v} = c_1 \vec{b}_1 + c_2 \vec{b}_2 + c_3 \vec{b}_3}
\end{equation*}
and these coefficients $c_1, c_2, c_3$ are unique.

\begin{definition}
The numbers $c_1, c_2, c_3$ are the \textbf{coordinates} of the vector $\vec{v}$ with respect to the basis $\set{\vec{b}_1, \vec{b}_2, \vec{b}_3}$.
\end{definition}

The \textbf{coordinate vector} of $\vec{v}$ is a column matrix which contains the coordinates of $\vec{v}$ with respect to a basis,
\begin{equation*}
    \vec{v} \quad \text{is represented by} \quad \begin{bmatrix} c_1 \\ c_2 \\ c_3 \end{bmatrix}
\end{equation*}
The coordinate vector is denoted by $\overline{\vec{v}}$. The overline indicates that $\vec{v}$ is a column. In this way, a vector $\vec{v}$ can have different coordinate vectors depending on the basis, but both coordinate vectors represent the same vector. Similarly, $\overline{v}$ might represent a row vector. In this way, a basis can be denoted by $\underline{\vec{b}}$, a row of basis vectors. Then, in matrix notation,
\begin{equation*}
    \vec{v} = \begin{bmatrix} \vec{b}_1 & \vec{b}_2 & \vec{b}_3 \end{bmatrix} \begin{bmatrix} c_1 \\ c_2 \\ c_2 \end{bmatrix} \qquad \text{or} \qquad \vec{v} = \underline{\vec{b}} \overline{\vec{v}}
\end{equation*}
In other words, a vector is represented as the product of a basis matrix, and the coordinates of $\vec{v}$ in the basis $\overline{\vec{b}}$.

\section*{Linear Transformations}
Recall that a linear transformation on a vector space $V$ is a function $T: V \rightarrow V$ such that
\begin{align*}
    T(\vec{v} + \vec{w}) & = T(\vec{v} + \vec{w}) \\
    T(\alpha \vec{v}) & = \alpha T(\vec{v})
\end{align*}
for all $\vec{v}, \vec{w} \in V, \alpha \in \mathbb{R}$. If $\vec{v} = c_1 \vec{b}_1 + c_2 \vec{b}_2 + c_3 \vec{b}_3$, then
\begin{align*}
    T(\vec{v}) & = T\brac{c_1 \vec{b}_1 + c_2 \vec{b}_2 + c_3 \vec{b}_3} \\
    & = c_1 T(\vec{b}_1) + c_2 T(\vec{b}_2) + c_3 T(\vec{b}_3) \\
    & = \begin{bmatrix} T(\vec{b}_1) & T(\vec{b}_2) & T(\vec{b}_3) \end{bmatrix} \begin{bmatrix} c_1 \\ c_2 \\ c_3 \end{bmatrix}
\end{align*}

In other words, the matrix $\begin{bmatrix} T(\vec{b}_1) & T(\vec{b}_2) & T(\vec{b}_3) \end{bmatrix}$ made up of the transformed basis vectors, can be used to determine the image of any vector $\vec{v}$. 

\section*{Change of Basis}
Let $\underline{\vec{b}} = \set{\vec{b}_1, \vec{b}_2}, \underline{\vec{a}} = \set{\vec{a}_1, \vec{a}_2}$ be bases in $\mathbb{R}^2$ (the case for $\mathbb{R}^3$ is analogous). The main problem is, given a vector $\vec{v}$ with coordinate vector $\overline{\vec{v}}_{\vec{b}}$ with respect to basis $\underline{\vec{b}}$ (i.e. $\vec{v} = \underline{\vec{b}} \overline{\vec{v}}_{\vec{b}}$), to determine its coordinates in the basis $\underline{\vec{a}}$. To do this, we need relations between the basis vectors in $\underline{\vec{a}}$ and $\underline{\vec{b}}$. Suppose that,
\begin{align*}
    \vec{b}_1 & = P_{11} \vec{a}_1 + P_{12} \vec{a}_2 \\
    \vec{b}_2 & = P_{21} \vec{a}_1 + P_{22} \vec{a}_2
\end{align*}
In other words, the ``old" basis in terms of a linear combination of the ``new" basis (which can always be done uniquely). Then, the coordinates of $\vec{v}$ with respect to $\underline{\vec{a}}$ is equal to,
\begin{equation*}
    \boxed{\overline{\vec{v}}_{\vec{a}} = \begin{bmatrix} P_{11} & P_{21} \\ P_{12} & P_{22} \end{bmatrix} \overline{\vec{v}}_{\vec{b}}}
\end{equation*}
The matrix $P = \begin{bmatrix} P_{ij} \end{bmatrix}$ is called the \textbf{change of basis matrix}. The columns of $P$ are the coordinates of the old basis vectors in terms of the new basis vectors.



\section*{Points and Affine Spaces}
\begin{itemize}
    \item Points can be added to a vector to form another point, $\tilde{p} + \vec{v} = \tilde{q}$, where $\vec{v}$ represents the motion in space required to get from $\tilde{p}$ to $\tilde{q}$.
    \item From the other perspective, two points can be subtracted, $\tilde{q} - \tilde{p} = \vec{v}$, and the result is interpreted in a similar way.
\end{itemize}

In an affine space, first specify an origin $\tilde{o}$ and a basis $\underline{\vec{b}} = \set{\vec{b}_1, \vec{b}_2, \vec{b}_3}$ (the origin can be chosen in any convenient way). Then, every point $\tilde{p}$ can be represented as $\tilde{p} = \tilde{o} + \vec{v}$ for some vector $\vec{v}$, and the vector $\vec{v}$ can be written in terms of the basis, i.e.
\begin{equation*}
    \tilde{p} = \tilde{o} + c_1 \vec{b}_1 + c_2 \vec{b}_2 + c_3 \vec{b}_3
\end{equation*}
for some coordinates $c_1, c_2, c_3$. This can be represented in matrix notation, as
\begin{equation*}
    \tilde{p} = \begin{bmatrix} \vec{b}_1 & \vec{b}_2 & \vec{b}_3 & \tilde{o} \end{bmatrix} \begin{bmatrix} c_1 \\ c_2 \\ c_3 \\ 1 \end{bmatrix}
\end{equation*}
where we define $1\tilde{o} = \tilde{o}$. Then, the point can be represented as the column vector, and the row vector is the \textbf{affine frame} (or \textbf{coordinate frame}, or simply \textbf{frame}), the ``basis" of the affine space, denoted by $\frame{b}$. A frame consists of an origin, and a basis. In addition, vectors can be represented in a frame as,
\begin{equation*}
    \vec{v} = \begin{bmatrix} \vec{b}_1 & \vec{b}_2 & \vec{b}_3 & \tilde{o} \end{bmatrix} \begin{bmatrix} c_1 \\ c_2 \\ c_3 \\ 0 \end{bmatrix}
\end{equation*}
where we define $0 \tilde{o} = \tilde{o}$. Coordinates with this extra entry which is 0 or 1 are called \textbf{homogeneous coordinates}. 

\section*{Affine Transformations}

\begin{equation*}
    \begin{bmatrix} a_{11} & a_{21} & a_{31} & a_{01} \\ a_{12} & a_{22} & a_{32} & a_{02} \\ a_{13} & a_{23} & a_{33} & a_{03} \\ 0 & 0 & 0 & 1 \end{bmatrix}
\end{equation*}



\section*{Change of Frame}
Similar to change of basis, if given two frames $\frame{b} = \begin{bmatrix} \vec{b}_1 & \vec{b}_2 & \vec{b}_3 & \tilde{b}_0 \end{bmatrix}, \frame{a} = \begin{bmatrix} \vec{a}_1 & \vec{a}_2 & \vec{a}_3 & \tilde{a}_0 \end{bmatrix}$, points and vectors represented in one frame can be converted into the other. If $\tilde{p} = \frame{b} \overline{p}_b$, and the frame $\frame{b}$ is represented in terms of $\frame{a}$ as (including the origin),
\begin{align*}
    \vec{b}_1 & = b_{11} \vec{a}_1 + b_{12} \vec{a}_2 + b_{13} \vec{a}_3 \\
    \vec{b}_2 & = b_{21} \vec{a}_1 + b_{22} \vec{a}_2 + b_{23} \vec{a}_3 \\
    \vec{b}_3 & = b_{31} \vec{a}_1 + b_{32} \vec{a}_2 + b_{33} \vec{a}_3 \\
    \tilde{b}_0 & = b_{01} \vec{a}_1 + b_{02} \vec{a}_2 + b_{03} \vec{a}_3 + \tilde{a}_0
\end{align*}
Then,
\begin{equation*}
    \boxed{\tilde{p}_a = \begin{bmatrix} b_{11} & b_{21} & b_{31} & b_{01} \\ b_{12} & b_{22} & b_{32} & b_{02} \\ b_{13} & b_{23} & b_{33} & b_{03} \\ 0 & 0 & 0 & 1 \end{bmatrix} \tilde{p}_b}
\end{equation*}
This matrix describes the \textbf{affine transformation} of a point. The first three columns, like before, represent the coordinates of the basis vectors of $\frame{b}$ in frame $\frame{a}$. The last column represents the coordinates of the origin of $\frame{b}$ in frame $\frame{a}$. This matrix can be denoted by $B$, representing the matrix to convert from frame $\frame{b}$ to frame $\frame{a}$,
\begin{equation*}
    \boxed{\tilde{p}_a = B \tilde{p}_b}
\end{equation*}

\section*{Graphics}
To describe the geometry of a scene, we use a hierarchy of frames. First, the \textbf{world frame} $\frame{w}$, a right-handed orthonormal frame, which never changes. The world frame, or the scene, is the ``stage" where other objects are placed. Other frames are described in terms of the world frame. Every object in the scene has its own right-handed orthonormal frame, called the \textbf{object frame} $\frame{o}$ (or \textbf{model frame}). To change the location of an object, we simply change its object frame, without needing to change its coordinates. This is given by,
\begin{equation*}
    \frame{o} = \frame{w} M
\end{equation*}
The matrix $M$ used to convert the world frame to the model frame is called the \textbf{model matrix}. Recall that the columns of $M$ are the basis $\tilde{w}$ in coordinates of $\frame{o}$, with the last column being the coordinates of the object frame origin in terms of the world frame.
\\ \\ Finally, in order to view the world and the objects, a camera must be positioned to capture the scene from its perspective, and create a 2D image of a 3D environment. This is called the \textbf{camera frame} (or \textbf{eye frame}) $\frame{c} = \begin{bmatrix} \vec{c}_x & \vec{c}_y & \vec{c}_z & \tilde{c}_0 \end{bmatrix}$. The objects in the world must be specified in terms of the camera frame. By convention, the camera frame is arranged so that the ``line of sight" is along the negative $z$-axis. By convention, the upward direction is the $y$-axis, and the $x$-axis is specified by the right-hand rule. If the camera frame has origin $\tilde{c}_0$ and the line of sight must point at $\tilde{p}$, with the ``up vector" $\vec{u}$, then the camera frame is given by,
\begin{itemize}
    \item $\overline{\vec{c}}_z = \operatorname{normalize}(\overline{c}_0 - \overline{p})$.
    \item $\overline{\vec{c}}_x = \operatorname{normalize}(\vec{u} \times \vec{c}_z)$.
    \item $\overline{\vec{c}}_y = \vec{c}_z \times \vec{c}_x$.
\end{itemize}
The camera can be thought of as another object, with its object frame. \textbf{LookAt} in Three.js produces $V = C^{-1}$ where $C$ is the camera matrix, which is used to transform world frame to camera frame, and $V$ is called the \textbf{view matrix}.


\section*{Transformations and Change of Frame (Transformation About an Auxilary Frame)}
Let $\frame{w}$ be the world frame, $\frame{a}$ be the camera frame, $\frame{a} = \frame{w} A$. Then, for a point $\tilde{p}$ in the world frame, $\tilde{p} = \frame{w} \overline{p}_w$. Then, we want to apply transformations (e.g. rotations) about the frame $\frame{a}$, rather than $\frame{w}$. Let $R$ be a rotation matrix in the frame $\frame{a}$. First, convert the point to eye coordinates, $\overline{p}_a = A^{-1} \overline{p}_w$ (as $\overline{p}_w = A \overline{p}_a$). Then, apply the transformation $R$, to get $\tilde{p}' = \frame{a} RA^{-1} \overline{p}_w$. Finally, convert back to the world frame. In summary,
\begin{equation*}
    \boxed{\tilde{p} = \frame{w} \overline{p}_w \quad \implies \quad \tilde{p}' = \frame{w} ARA^{-1} \overline{p}_w}
\end{equation*}
This matrix $ARA^{-1}$ is sometimes called a \textbf{similarity transformation} of $R$, as $ARA^{-1}$ is essentially $R$ but applied to a different coordinate frame. It is often computed once in order to be applied to a large number of points.

\section*{Hierarchy of Transformations, Scene Graphs}
A scene graph manages hierarchical transformations. 

\begin{example}
For example, a world may have a car object, which may have multiple tires. The rotation transformations of the tires are done with respect to the car, and the car is transformed with respect to the world. Other objects are included, e.g. a building, etc. and also the camera.
\end{example}

In Three.js, Object3D represents each node and its edge to its parent. Mesh is a subclass of Object3D. In Three.js, the transformation matrices are just called ``matrix" e.g. A\textbf{.matrix}. The chain to the world frame is A\textbf{.matrixWorld}. This matrix world computes the matrix multiplication for you. Create an ``edge" in a scene graph using ``add" scene\textbf{.add()}. These hierarchies are developed in the Javascript programs and passed to the shaders as uniform variables. Upcoming, animating meshes requires creating a ``skeleton", where the Object3D's are called Bones.

\section*{Interpreting Hierarchies of Transformations}
Consider a hierarchy of transformations $C \rightarrow B \rightarrow A$. Then, consider the transformation of a point $\tilde{p}$ from coordinates in frame $\frame{a}$, to world coordinates,
\begin{equation*}
    \tilde{p} = \frame{w} \overline{p}_w = \frame{w} CBA \overline{p}_a
\end{equation*}
The sequence of matrix multiplications has two main interpretations:
\begin{itemize}
    \item \textbf{Successive coordinate transformations},
    \begin{equation*}
        \frame{w} \underbrace{C \underbrace{B \underbrace{A \overline{p}_a}_{\overline{p}_b}}_{\overline{p}_c}}_{\overline{p}_w}
    \end{equation*}
    \item \textbf{Successive frame transformations}, start with a point $\tilde{p}_1$ and move it to $\tilde{p}_2$.
    \begin{equation*}
        \underbrace{\underbrace{\underbrace{\frame{w} C}_{\frame{c}} B}_{\frame{b}} A}_{\frame{a}} \overline{p}_a
    \end{equation*}
\end{itemize}


\section*{Types of Transformations}
The main types of transformations are \textbf{translation}, \textbf{rotation}, and \textbf{scaling}.
\begin{itemize}
    \item \textbf{Translation},
    \begin{equation*}
        T = \begin{bmatrix} 1 & 0 & 0 & b_{01} \\ 0 & 1 & 0 & b_{02} \\ 0 & 0 & 1 & b_{03} \\ 0 & 0 & 0 & 1 \end{bmatrix}
    \end{equation*}
    where the frame transformation is just the identity (no change), and the origin is translated to coordinates $(b_{01}, b_{02}, b_{03})$. Indeed,
    \begin{equation*}
        Tx = \begin{bmatrix} 1 & 0 & 0 & b_{01} \\ 0 & 1 & 0 & b_{02} \\ 0 & 0 & 1 & b_{03} \\ 0 & 0 & 0 & 1 \end{bmatrix} \begin{bmatrix} x_1 \\ x_2 \\ x_3 \\ 1 \end{bmatrix} = \begin{bmatrix} x_1 + b_{01} \\ x_2 + b_{02} \\ x_3 + b_{03} \\ 1 \end{bmatrix}
    \end{equation*}
    \item \textbf{Rotation}. A rotation is a linear transformation which keeps the origin unchanged, is an isometry in that $\norm{Ru} = \norm{u}$.
    \begin{equation*}
        \begin{bmatrix} & & & 0 \\ & R & & 0 \\ & & & 0 \\ 0 & 0 & 0 & 1 \end{bmatrix}
    \end{equation*}
    To satisfy $\norm{Rv} = \norm{v}$, we have $\norm{Rv}^2 = (Rv)^T Rv = v^T R^T R v$ and $\norm{v} = v^T v$. For these to be equal, we need $R^T R = I$. A matrix $R$ with this property is called \textbf{orthogonal}. If $R = \begin{bmatrix} \vec{r}_x & \vec{r}_y & \vec{r}_z \end{bmatrix}$ are the columns of $R$, then we need
    \begin{align*}
        R^T R = \begin{bmatrix} \vec{r}_x & \vec{r}_y & \vec{r}_z \end{bmatrix} \begin{bmatrix} \vec{r}_x \\ \vec{r}_y \\ \vec{r}_z \end{bmatrix} = \begin{bmatrix} 1 & 0 & 0 \\ 0 & 1 & 0 \\ 0 & 0 & 1 \end{bmatrix}
    \end{align*}
    so $\vec{r}_x^T \vec{r}_x = \vec{r}_y^T \vec{r}_y = \vec{r}_z^T \vec{r}_z = 1$ (the magnitudes of each column is 1) and $\vec{r}_x^T \vec{r}_y = \vec{r}_x^T \vec{r}_z = \vec{r}_y^T \vec{r}_z = 0$ (the columns are pairwise orthogonal). This means that the columns of $R$ form an orthonormal basis. The product of two orthogonal matrices is orthogonal, as
    \begin{equation*}
        (R_1 R_2)^T R_1 R_2 = R_2^T R_1^T R_1 R_2 = R_2^T R_2 = I
    \end{equation*}
    The final property is that $\det{R} = 1$. A rotation by angle $\theta$ about the $z$-axis is,
    \begin{equation*}
        \boxed{R_z = \begin{bmatrix} \cos{\theta} & -\sin{\theta} & 0 \\ \sin{\theta} & \cos{\theta} & 0 \\ 0 & 0 & 1 \end{bmatrix}}
    \end{equation*}
    Similarly, rotation by angle $\theta$ about the $x$-axis, and the $y$-axis, are given by,
    \begin{equation*}
        \boxed{R_x = \begin{bmatrix} 1 & 0 & 0 \\ 0 & \cos{\theta} & -\sin{\theta} \\ 0 & \sin{\theta} & \cos{\theta} \end{bmatrix}} \qquad \boxed{R_y = \begin{bmatrix} \cos{\theta} & 0 & \sin{\theta} \\ 0 & 1 & 0 \\ -\sin{\theta} & 0 & \cos{\theta} \end{bmatrix}}
    \end{equation*}
    In general,
    \begin{theorem}
    Every rotation transformation can be written as a product of $R_x, R_y, R_z$.
    \end{theorem}
    This implies that the three angles $\theta_x, \theta_y, \theta_z$ (rotation about $x, y$, and $z$-axes) are sufficient to represent any rotation. On the other hand, for a given general rotation, the representation in terms of rotation angles may not be unique.
    \item \textbf{Scaling},
    \begin{equation*}
        S = \begin{bmatrix} s_x & 0 & 0 & b_{01} \\ 0 & s_y & 0 & b_{02} \\ 0 & 0 & s_z & b_{03} \\ 0 & 0 & 0 & 1 \end{bmatrix}
    \end{equation*}
\end{itemize}



\section*{Normal Vectors after Transformations}

Let $T$ be an (affine) transformation, and let $\vec{t}$ be the tangent vector to a surface at a point $\tilde{p}$. Define the normal vector as a unit vector $\vec{n}$ such that $\vec{n} \bullet \vec{t} = 0$. Recall that if $\vec{t}$ is the tangent to $\tilde{p}$, then $\vec{t}_a = T \vec{t}$ is the tangent vector to the transformed point. In other words, tangent vectors behave well under affine transformations. However, this is not the case for normal vectors. In other words, normal vectors transformed by an affine transformation are not normal to the transformed surface.
\\ \\ Then, if $\vec{t}_a = T \vec{t}$, then we want the new normal vector $\vec{n}_a$ to be such that $\vec{n}_a \bullet \vec{t}_a = 0$, or $\vec{n}_a T \vec{t} = 0$. This implies that $\vec{n}^T = \vec{n}_a^T T$, or $\vec{n} = T^T \vec{n}_a$, and so $\vec{n}_a = (T^T)^{-1} \vec{n}$. In fact, we can ignore the last column of $T$, as
\begin{align*}
    T^T = \begin{bmatrix} A & 0 \\ 0 & 1 \end{bmatrix}^{-1} = \begin{bmatrix} A^{-1} & 0 \\ 0 & 1 \end{bmatrix}
\end{align*}
The matrix $A^{-T}$ is called the \textbf{normalMatrix}, which transforms normal vectors. Also, $T$ is the modelView matrix.
\begin{equation*}
    \boxed{\vec{n}_a = \begin{bmatrix} A^{-T} & 0 \\ 0 & 1 \end{bmatrix} \vec{n}}
\end{equation*}
where $A^{-T}$ is the inverse transpose of $A$, and $A$ is the linear transformation part of the affine transformation $T$.

\end{document}